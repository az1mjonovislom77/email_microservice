# Email Microservice

## Описание проекта

**Email Microservice** — это микросервис, предоставляющий API-интерфейс для работы с электронной почтой. Он позволяет:

Отправлять письма через SMTP
Получать список отправленных и полученных писем с фильтрацией
Получать статистику по письмам за указанный период

Проект реализован с использованием **FastAPI**, **PostgreSQL**, **Docker**, с поддержкой **автодокументации (Swagger/OpenAPI)**, модульной архитектуры, конфигурацией через `.env`, структурированным логированием и покрытием тестами (`pytest`).

---

## Быстрый старт

> Убедитесь, что у вас установлен Docker и Docker Compose

### Установка и запуск:

```bash
git clone https://github.com/azimjonovislom77/email_microservice.git
cd email_microservice
cp .env
docker-compose up --build -d
```

### Доступ:

API документация: http://localhost:8000/api/docs  
Веб-интерфейс Mailhog (для проверки писем): http://localhost:18025  
Проверка здоровья сервиса: http://localhost:8000/health  

---

## Функциональность API

### 1. Отправка письма

**POST** `/api/v1/emails/send`  
Отправляет письмо через SMTP сервер и сохраняет его в базе данных.

**Пример запроса:**
```json
{
  "to": ["user@example.com"],
  "subject": "Тестовое письмо",
  "body": "Содержимое письма (можно использовать HTML)"
}
```

### 2. Получение писем

**GET** `/api/v1/emails`  
Возвращает список входящих и исходящих писем.

**Фильтрация по:**
отправителю (`sender`)
получателю (`recipient`)
теме (`subject`)
диапазону дат (`date_from`, `date_to`)

### 3. Статистика по письмам

**GET** `/api/v1/emails/stats?date_from=YYYY-MM-DD&date_to=YYYY-MM-DD`  
Выводит количество отправленных и полученных писем за указанный период.

---

## Переменные окружения

Все настройки хранятся в файле `.env`.

---

## Структура проекта

```
email_microservice/
    app/
       main.py                # Инициализация FastAPI
        api/                   # Роуты и схемы API
        core/                  # Конфигурация, логирование
        db/                    # База данных: модели, сессии
        services/              # Логика отправки и статистики
        tests/                 # Тесты (pytest)
    docker-compose.yml         # Сборка и запуск всех сервисов
    Dockerfile                 # Docker-образ приложения
    .env                       # Переменные окружения
    requirements.txt           # Зависимости
    README.md                  # Этот файл
```

---


## Логирование

Сервис использует **структурированное логирование** в формате JSON.  
Вывод логов разделён по уровням: `INFO`, `ERROR`, и настраивается через `app/core/logger.py`.

---

## Технологии и библиотеки

- **Язык:** Python 3.10+
- **Фреймворк:** FastAPI
- **База данных:** PostgreSQL
- **Отправка писем:** smtplib (SMTP)
- **Контейнеризация:** Docker + Docker Compose
- **Тесты:** pytest
- **Документация:** Swagger/OpenAPI (`/api/docs`)
- **SMTP-сервер для разработки:** MailHog (доступен на порту `18025`)

---

## Команды разработчика

```bash
# Перезапуск всего стека
docker-compose down
docker-compose up --build -d

# Проверка логов
docker-compose logs -f

# Вход в контейнер
docker exec -it test_email-web-1 /bin/bash
```

---

## Возможности расширения

- Подключение реального SMTP/IMAP сервера (например, Mailu)
- Поддержка вложений
- Авторизация пользователей
- Асинхронная отправка писем через Celery

---

## Автор

Проект разработан в рамках тестового задания.  
Контакты для связи: [azimjonovislomjon77@gmail.com]

---

